<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Arch Linux Notes | 梦断代码</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="This is my notebook for some small tips and tricks when using Arch Linux. Why Arch Linux? It is fresh and simple in package dependency.  It has a powerful Arch User Repository and makes it easy for yo">
<meta name="keywords" content="Note,Linux,Software">
<meta property="og:type" content="article">
<meta property="og:title" content="Arch Linux Notes">
<meta property="og:url" content="http://blog.zhanghai.me/arch-linux-notes/index.html">
<meta property="og:site_name" content="梦断代码">
<meta property="og:description" content="This is my notebook for some small tips and tricks when using Arch Linux. Why Arch Linux? It is fresh and simple in package dependency.  It has a powerful Arch User Repository and makes it easy for yo">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-02-11T04:41:11.351Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Arch Linux Notes">
<meta name="twitter:description" content="This is my notebook for some small tips and tricks when using Arch Linux. Why Arch Linux? It is fresh and simple in package dependency.  It has a powerful Arch User Repository and makes it easy for yo">
  
    <link rel="alternative" href="/atom.xml" title="梦断代码" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-100427567-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div class="mobile-nav-panel">
  <i class="icon-reorder icon-large"></i>
</div>
<header id="header">
  <h1 class="blog-title">
    <a href="/">梦断代码</a>
  </h1>
  <nav class="nav">
    <ul>
      <li><a href="/">主页</a></li><li><a href="/archives">存档</a></li>
      <li><a id="nav-search-btn" class="nav-icon" title="搜索"></a></li>
      <li><a href="/atom.xml" id="nav-rss-link" class="nav-icon" title="RSS 订阅"></a></li>
    </ul>
  </nav>
  <div id="search-form-wrap">
    <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.zhanghai.me"></form>
  </div>
</header>

    <section id="main">
      <article id="post-arch-linux-notes" class="post">
  <header class="entry-meta-header">
    <span class="meta-elements date">
      <a href="/arch-linux-notes/" class="article-date">
  <time datetime="2014-11-03T22:18:11.000Z" itemprop="datePublished">11月 3 2014</time>
</a>

    </span>
    <span class="meta-elements author">张海</span>
    <div class="commentscount">
      
        <a href="http://blog.zhanghai.me/arch-linux-notes/#disqus_thread" class="article-comment-link">评论</a>
      
    </div>
  </header>
  

  <header class="entry-header">
    
  
    <h1 class="article-title entry-title" itemprop="name">
      Arch Linux Notes
    </h1>
  


  </header>
  <div class="entry-content">
    
      <p>This is my notebook for some small tips and tricks when using Arch Linux.</p>
<h2 id="Why-Arch-Linux"><a href="#Why-Arch-Linux" class="headerlink" title="Why Arch Linux?"></a>Why Arch Linux?</h2><ul>
<li><p>It is fresh and simple in package dependency.</p>
</li>
<li><p>It has a powerful Arch User Repository and makes it easy for you to make/modify your package.</p>
</li>
<li><p>It has a detailed Arch Wiki comprising useful experiences and recommendations.</p>
</li>
<li><p>It gets you to learn the basic knowledge required to be a Linux user/administrator/programmer.</p>
</li>
</ul>
<a id="more"></a>
<h2 id="Refer-to-manual"><a href="#Refer-to-manual" class="headerlink" title="Refer to manual"></a>Refer to manual</h2><p>Use <code>man [SECTION] &lt;NAME&gt;</code> to show a manual.</p>
<p>Use <code>whatis &lt;NAME&gt;</code> to find out which sections are available in manual.</p>
<p>Use <code>apropos &lt;KEYWORD&gt;</code> to search for manuals whose name or description contains certain keyword.</p>
<p>Use <code>man man-pages</code> to see the definition of each seciton.</p>
<p>Use <code>help -m &lt;BUILTIN&gt;</code> to show help for a shell builtin in manual page format.</p>
<p>The “SEE ALSO” section in a manual sometimes can be very helpful.</p>
<p>You can also use <code>man hier</code>to get to know the Linux filesystem hierarchy.</p>
<h2 id="Find-available-commands"><a href="#Find-available-commands" class="headerlink" title="Find available commands"></a>Find available commands</h2><p>Shell builtin <code>compgen</code> can list possible completions for your input.</p>
<h2 id="NTFS-partitions-auto-mounting"><a href="#NTFS-partitions-auto-mounting" class="headerlink" title="NTFS partitions auto mounting"></a>NTFS partitions auto mounting</h2><ol>
<li><p>Use <code>gnome-disks</code>, select partition and click the settings button below, click and then modify mount options in the popup menu.</p>
</li>
<li><p>Install <code>ntfs-config</code> and enable auto mounting.</p>
</li>
</ol>
<h2 id="Disable-Nvidia-graphics"><a href="#Disable-Nvidia-graphics" class="headerlink" title="Disable Nvidia graphics"></a>Disable Nvidia graphics</h2><p>Install <code>bbswitch</code>.</p>
<p>And create <code>/etc/modprobe.d/nouveau_blacklist.conf</code> as follow, or else <code>bbswitch</code> will find Nvidia graphics in use by <code>nouveau</code>.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blacklist nouveau</span><br></pre></td></tr></table></figure>
<p>You can verify <code>bbswitch</code> status by <code>cat /proc/acpi/bbswitch</code> and view its log by <code>dmesg | grep bbswitch</code>.</p>
<p>Note that the <code>nouveau</code> kernel module is shipped in <code>linux</code>. And once in a specific packaging of <code>linux</code>, <code>nvidiafb</code> is also shipped and need to be blacklisted.</p>
<p>Also note that if your install <code>bumblebee</code>, it will ship the blacklist file for you.</p>
<h2 id="Hardware-video-acceleration"><a href="#Hardware-video-acceleration" class="headerlink" title="Hardware video acceleration"></a>Hardware video acceleration</h2><p>See <a href="https://wiki.archlinux.org/index.php/Hardware_video_acceleration" target="_blank" rel="noopener">Arch Wiki</a>.</p>
<p>If <code>mkv</code> playback doesn’t work well in VLC, remove <code>libvdpau-va-gl</code>.</p>
<h2 id="Shrink-pacman-cache"><a href="#Shrink-pacman-cache" class="headerlink" title="Shrink pacman cache"></a>Shrink pacman cache</h2><p>From <a href="https://wiki.archlinux.org/index.php/pacman" target="_blank" rel="noopener">Arch Wiki</a>:</p>
<p><code>paccache -r</code> deletes all the cached versions of each package except for the most recent 3 (without confirmation).</p>
<p><code>paccache -ruk0</code> removes all the cached versions of uninstalled packages.</p>
<p>See <code>paccache -h</code> for dry run and other parameters.</p>
<h2 id="Better-diff"><a href="#Better-diff" class="headerlink" title="Better diff"></a>Better diff</h2><p><code>alias diff=&#39;git diff --no-index&#39;</code> works great with the only requirement of <code>git</code>.</p>
<h2 id="Make-programs-use-proxy"><a href="#Make-programs-use-proxy" class="headerlink" title="Make programs use proxy"></a>Make programs use proxy</h2><p>There are several ways to make a program proxied. Part of the following comes from <a href="https://wiki.archlinux.org/index.php/proxy_settings" target="_blank" rel="noopener">Arch Wiki</a>.</p>
<ul>
<li><p>Environment variables</p>
<p>  Some programs respect proxy set via environment variables.</p>
  <!-- Unable to wrap a backtick code block in a list item. -->
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> http_proxy=http://10.203.0.1:5187/</span><br><span class="line"><span class="built_in">export</span> https_proxy=<span class="variable">$http_proxy</span></span><br><span class="line"><span class="built_in">export</span> ftp_proxy=<span class="variable">$http_proxy</span></span><br><span class="line"><span class="built_in">export</span> rsync_proxy=<span class="variable">$http_proxy</span></span><br><span class="line"><span class="built_in">export</span> no_proxy=<span class="string">"localhost,127.0.0.1,localaddress,.localdomain.com"</span></span><br></pre></td></tr></table></figure>
<p>  It is sometimes advised that you export these environment variables again, with their names upper cased.</p>
</li>
<li><p>Proxychains</p>
<p>  Install <a href="https://www.archlinux.org/packages/?name=proxychains-ng" target="_blank" rel="noopener">proxychains-ng</a>. Proxychains hooks some C library functions so that programs gets proxied. However the Java VM cannot be proxied this way.</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains &lt;YOUR_PROGRAM&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Java</p>
<p>  From <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/net/proxies.html" target="_blank" rel="noopener">the documentation of Java</a>:</p>
<ul>
<li><p>HTTP</p>
<ul>
<li><p>http.proxyHost: the host name of the proxy server</p>
</li>
<li><p>http.proxyPort: the port number, the default value being 80.</p>
</li>
<li><p>http.nonProxyHosts: a list of hosts that should be reached directly, bypassing the proxy. This is a list of patterns separated by ‘|’. The patterns may start or end with a ‘*’ for wildcards. Any host matching one of these patterns will be reached through a direct connection instead of through a proxy.</p>
</li>
</ul>
</li>
<li><p>HTTPS</p>
<ul>
<li><p>https.proxyHost</p>
<p>https.proxyPort</p>
</li>
</ul>
</li>
<li><p>FTP</p>
<ul>
<li><p>ftp.proxyHost (Typo in official documentation)</p>
</li>
<li><p>ftp.proxyPort</p>
</li>
<li><p>ftp.nonProxyHosts</p>
</li>
</ul>
</li>
<li><p>SOCKS</p>
<ul>
<li><p>socksProxyHost for the host name of the SOCKS proxy server</p>
</li>
<li><p>socksProxyPort for the port number, the default value being 1080</p>
</li>
<li><p>socksProxyVersion for the version of the SOCKS protocol, the default being 5, and alternatively 4 can be specified.</p>
</li>
</ul>
<p>Note: socksProxyVersion and more properties are documented at <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/net/properties.html" target="_blank" rel="noopener">another documentation of Java</a>.</p>
<p>Sample usage:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Dhttp.proxyHost=webcache.example.com -Dhttp.proxyPort=8080 -Dhttp.nonProxyHosts=<span class="string">'localhost|host.example.com'</span></span><br></pre></td></tr></table></figure>
<p>Or you can utilize <code>_JAVA_OPTIONS</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> _JAVA_OPTIONS=<span class="string">"-DsocksProxyHost=localhost -DsocksProxyPort=10801"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>Note that you can tunnel http(s) request to local socks client using <a href="https://wiki.archlinux.org/index.php/polipo" target="_blank" rel="noopener">Polipo</a>, for example <code>polipo socksParentProxy=localhost:10800</code>.</p>
<h2 id="Touchpad-settings-and-horizontal-two-finger-scrolling-doesn’t-work"><a href="#Touchpad-settings-and-horizontal-two-finger-scrolling-doesn’t-work" class="headerlink" title="Touchpad settings and horizontal two-finger scrolling doesn’t work"></a>Touchpad settings and horizontal two-finger scrolling doesn’t work</h2><p>GNOME dropped support for synaptics driver due to luck of maintenance in version 3.20.</p>
<p>Remove <code>xf86-input-synaptics</code> and <code>xf86-input-evdev</code>, install <code>xf86-input-libinput</code>, then reboot.</p>
<h2 id="GNOME-proxy-setting"><a href="#GNOME-proxy-setting" class="headerlink" title="GNOME proxy setting"></a>GNOME proxy setting</h2><p>You can utilize GNOME’s proxy setting in <code>Settings &gt; Network</code> <del>even if you use <code>netctl</code> instead of <code>Network Manager</code></del> (Disabled in recent GNOME, see below). Both HTTP and SOCKS proxy are supported.</p>
<p>You can also modify proxy setting with <code>dconf-editor</code>, Set <code>system.proxy.mode</code> to <code>manual</code>, then set your proxy in <code>system.proxy.{ftp,http,https,socks}</code>.</p>
<p>Note that the proxy setting will also be read and set to corresponding environment variables by <code>gnome-terminal</code>, and no option is offered to turn this behavior off. To avoid setting proxy environment variables, reset the environment variables in your <code>.bashrc</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Unset global proxy set by gnome-terminal</span></span><br><span class="line"><span class="comment"># See https://github.com/GNOME/gnome-terminal/blob/master/src/terminal-util.c</span></span><br><span class="line"><span class="built_in">unset</span> http_proxy https_proxy ftp_proxy all_proxy no_proxy</span><br><span class="line"><span class="built_in">unset</span> HTTP_PROXY HTTPS_PROXY FTP_PROXY ALL_PROXY NO_PROXY</span><br></pre></td></tr></table></figure>
<h2 id="GNOME-online-account"><a href="#GNOME-online-account" class="headerlink" title="GNOME online account"></a>GNOME online account</h2><p>You can log in your Google account and all the things will be configured and synchronized automatically to your laptop. It can be a huge boost for your work flow.</p>
<p>If you need a proxy to access Google, configure it as in the GNOME proxy setting section.</p>
<h2 id="Save-ssh-key-passphrase-to-keyring"><a href="#Save-ssh-key-passphrase-to-keyring" class="headerlink" title="Save ssh key passphrase to keyring"></a>Save ssh key passphrase to keyring</h2><p>As in <a href="https://wiki.archlinux.org/index.php/GNOME_Keyring#SSH_keys" target="_blank" rel="noopener">Arch Wiki</a>, use <code>seahorse-ssh-askpass</code>.</p>
<p>As of <code>seahorse</code> 3.18.0-2, <code>SSH_ASKPASS</code> is not exported by default anymore, so you will need to add the following lines to your <code>/etc/profile</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set ssh askpass</span></span><br><span class="line">SSH_ASKPASS=/usr/lib/seahorse/seahorse-ssh-askpass</span><br></pre></td></tr></table></figure>
<h2 id="Nautilus-hangs-occasionally"><a href="#Nautilus-hangs-occasionally" class="headerlink" title="Nautilus hangs occasionally"></a>Nautilus hangs occasionally</h2><p>In my case it often happened when I started to search something. Turned out that it is caused by my putting too many files under indexed directories.</p>
<p>To fix the hang up, launch <code>tracker-preferences</code>, go to “Locations” tab, and turn off “Recurse” for directories you may store a large amount of files. Then execute <code>tracker reset --hard</code> to reset tracker index and configurations. This resolved my issue so far.</p>
<h2 id="DNS-and-resolvconf"><a href="#DNS-and-resolvconf" class="headerlink" title="DNS and resolvconf"></a>DNS and resolvconf</h2><p>DNS is managed by <code>resolvconf</code> in Arch Linux. In order to supply your own DNS, edit <code>/etc/resolvconf.conf</code>.</p>
<p>There are two options you may normally want to specify:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name_servers</span>=&lt;DNS1&gt; #Prepended into DNS list</span><br><span class="line"><span class="attr">name_servers_append</span>=<span class="string">"&lt;DNS2&gt; &lt;DNS3&gt; ..."</span></span><br></pre></td></tr></table></figure>
<p>After modification, you may want to execute <code>resolvconf -u</code> to update <code>resolv.conf</code>.</p>
<p>Note that <code>dhcpd</code> also setup DNS for interfaces via <code>resolvconf</code>, in <code>/run/resolvconf/interface/&lt;INTERFACE&gt;</code>. You can override its behavior by executing <code>dhcpcd -S domain_name_servers=&lt;DNS&gt;</code>, or inside <code>dhcpcd.conf</code>.</p>
<h2 id="Boost-entropy"><a href="#Boost-entropy" class="headerlink" title="Boost entropy"></a>Boost entropy</h2><p>If the output of <code>cat /proc/sys/kernel/random/entropy_avail</code> is less than 1000, you need to install and enable <code>havedged</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S havedged</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> havedged</span><br><span class="line">sudo systemctl start havedged</span><br></pre></td></tr></table></figure>
<h2 id="Create-software-AP-Access-Point-a-k-a-virtual-WiFi"><a href="#Create-software-AP-Access-Point-a-k-a-virtual-WiFi" class="headerlink" title="Create software AP (Access Point), a.k.a. virtual WiFi"></a>Create software AP (Access Point), a.k.a. virtual WiFi</h2><p>Install AUR package <code>create_ap</code>; you may want to remove the <code>wifi.service</code> it automatically creates when installed and use your own.</p>
<p>Check the Capabilities section in <code>iw list</code> along with <code>/usr/share/doc/hostapd/hostapd.conf</code> to determine <code>ht_capab</code>.</p>
<p>Note that in ZJU, ZJUWLAN occupies channel 1 and 6, so you’d better specify another channel.</p>
<p>Sample systemd service:</p>
<p>File: <code>&lt;YOUR_SSID&gt;@.service</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Create AP service for &lt;YOUR_SSID&gt;</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/bin/create_ap -c <span class="number">13</span> -w <span class="number">2</span> -m nat --ieee80211n --ht_capab [HT40-][HT40+][SMPS-STATIC][GF][SHORT-GI-<span class="number">20</span>][SHORT-GI-<span class="number">40</span>][DSSS_CCK-<span class="number">40</span>] &lt;YOUR_WLAN_INTERFACE&gt; %i &lt;YOUR_SSID&gt; &lt;YOUR_PASSPHRASE&gt;</span><br><span class="line"><span class="attr">ExecStop</span>=pkill hostapd</span><br><span class="line"><span class="attr">KillSignal</span>=SIGINT</span><br><span class="line"><span class="attr">Restart</span>=<span class="literal">on</span>-failure</span><br><span class="line"><span class="attr">RestartSec</span>=<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure>
<p>However on my own machine, I cannot share a secure (with password) network.</p>
<h2 id="Analyze-network-issue"><a href="#Analyze-network-issue" class="headerlink" title="Analyze network issue"></a>Analyze network issue</h2><p>Use <code>mtr</code>(My traceroute), a tool combining much of the functionality of ping and traceroute into one interface.</p>
<h2 id="See-who’s-using-a-file-filesystem-or-port"><a href="#See-who’s-using-a-file-filesystem-or-port" class="headerlink" title="See who’s using a file, filesystem or port"></a>See who’s using a file, filesystem or port</h2><p>Use <code>fuser</code>, with <code>fuser -v &lt;FILE&gt;</code> for a file, <code>fuser -vm &lt;FILE&gt;</code> for filesystem of that file, and <code>fuser -vn &lt;tcp|udp&gt; &lt;port&gt;</code> for port.</p>
<h2 id="Raise-inotify-limit-for-IntelliJ-IDEA"><a href="#Raise-inotify-limit-for-IntelliJ-IDEA" class="headerlink" title="Raise inotify limit for IntelliJ IDEA"></a>Raise inotify limit for IntelliJ IDEA</h2><p>Write the following line to <code>/etc/sysctl.d/99-custom.conf</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.inotify.max_user_watches = 524288</span><br></pre></td></tr></table></figure>
<h2 id="Sysrq"><a href="#Sysrq" class="headerlink" title="Sysrq"></a>Sysrq</h2><p>Write the following line to <code>/etc/sysctl.d/99-custom.conf</code> to enable all the sysrq operations.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kernel.sysrq = 1</span><br></pre></td></tr></table></figure>
<p>Reboot to make changes take effect, or execute <code>echo 1 &gt;/proc/sys/kernel/sysrq</code>.</p>
<p>Hold <code>Alt</code>, and press the following key sequence.</p>
<ol>
<li><code>SysRq</code></li>
<li><code>R</code>    unRaw</li>
<li><code>E</code>    tErminate</li>
<li><code>I</code>    kIll</li>
<li><code>S</code>    Sync</li>
<li><code>U</code>    Unmount</li>
<li><code>B</code>    reBoot</li>
</ol>
<p>Note that the key <code>C</code> can make your kernel panic immediately.</p>
<h2 id="Watch-FS-buffer-status"><a href="#Watch-FS-buffer-status" class="headerlink" title="Watch FS buffer status"></a>Watch FS buffer status</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch grep -e Dirty: -e Writeback: /proc/meminfo</span><br></pre></td></tr></table></figure>
<p>You can execute <code>sync</code> to flush the buffer immediately.</p>
<h2 id="Map-Alt-Gr-Right-Alt-to-Alt-in-tty"><a href="#Map-Alt-Gr-Right-Alt-to-Alt-in-tty" class="headerlink" title="Map Alt Gr (Right Alt) to Alt in tty"></a>Map Alt Gr (Right Alt) to Alt in tty</h2><p>From <a href="https://wiki.archlinux.org/index.php/Keyboard_Configuration_in_Console_%28%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87%29" target="_blank" rel="noopener">Arch Wiki</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/share/kbd/keymaps/i386/qwerty</span><br><span class="line">cp us.map.gz us-two-alt-keys.map.gz</span><br><span class="line">gunzip us-two-alt-keys.map.gz</span><br></pre></td></tr></table></figure>
<p>Edit <code>us-two-alt-keys.map</code>，replace <code>include &quot;linux-with-alt-and-altgr&quot;</code> with <code>include &quot;linux-with-two-alt-keys&quot;</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gzip us-two-alt-keys.map</span><br></pre></td></tr></table></figure>
<p>Edit <code>/etc/vconsole.conf</code>, replace <code>KEYMAP=us</code> with <code>KEYMAP=us-two-alt-keys</code>.</p>
<p>Reboot.</p>
<h2 id="Better-bash-bashrc"><a href="#Better-bash-bashrc" class="headerlink" title="Better bash.bashrc"></a>Better bash.bashrc</h2><p>Originally from <a href="https://wiki.archlinux.org/index.php/Color_Bash_Prompt" target="_blank" rel="noopener">Arch Wiki</a>, but now the page is deleted. Anyway you can still access its <a href="https://wiki.archlinux.org/index.php/Color_Bash_Prompt_%28%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87%29" target="_blank" rel="noopener">Chinese version</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/bash.bashrc</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># https://wiki.archlinux.org/index.php/Color_Bash_Prompt</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This file is sourced by all *interactive* bash shells on startup,</span></span><br><span class="line"><span class="comment"># including some apparently interactive shells such as scp and rcp</span></span><br><span class="line"><span class="comment"># that can't tolerate any output. So make sure this doesn't display</span></span><br><span class="line"><span class="comment"># anything or bad things will happen !</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Test for an interactive shell. There is no need to set anything</span></span><br><span class="line"><span class="comment"># past this point for scp and rcp, and it's important to refrain from</span></span><br><span class="line"><span class="comment"># outputting anything in those cases.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If not running interactively, don't do anything!</span></span><br><span class="line">[[$- != *i*]] &amp;&amp; <span class="built_in">return</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Bash won't get SIGWINCH if another process is in the foreground.</span></span><br><span class="line"><span class="comment"># Enable checkwinsize so that bash will check the terminal size when</span></span><br><span class="line"><span class="comment"># it regains control.</span></span><br><span class="line"><span class="comment"># http://cnswww.cns.cwru.edu/~chet/bash/FAQ (E11)</span></span><br><span class="line"><span class="built_in">shopt</span> -s checkwinsize</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable history appending instead of overwriting.</span></span><br><span class="line"><span class="built_in">shopt</span> -s histappend</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$&#123;TERM&#125;</span> <span class="keyword">in</span></span><br><span class="line">	xterm*|rxvt*|Eterm|aterm|kterm|gnome*)</span><br><span class="line">		PROMPT_COMMAND=<span class="variable">$&#123;PROMPT_COMMAND:+$PROMPT_COMMAND; &#125;</span><span class="string">'printf "\033]0;%s@%s:%s\007" "$&#123;USER&#125;" "$&#123;HOSTNAME%%.*&#125;" "$&#123;PWD/#$HOME/~&#125;"'</span></span><br><span class="line">		;;</span><br><span class="line">	screen*)</span><br><span class="line">		PROMPT_COMMAND=<span class="variable">$&#123;PROMPT_COMMAND:+$PROMPT_COMMAND; &#125;</span><span class="string">'printf"\033_%s@%s:%s\033\\""$&#123;USER&#125;" "$&#123;HOSTNAME%%.*&#125;" "$&#123;PWD/#$HOME/~&#125;"'</span></span><br><span class="line">		;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># fortune is a simple program that displays a pseudorandom message</span></span><br><span class="line"><span class="comment"># from a database of quotations at logon and/or logout.</span></span><br><span class="line"><span class="comment"># If you wish to use it, please install "fortune-mod" from the</span></span><br><span class="line"><span class="comment"># official repositories, then uncomment the following line:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [["$PS1"]] &amp;&amp; /usr/bin/fortune</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set colorful PS1 only on colorful terminals.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 2016-02-11</span></span><br><span class="line"><span class="comment"># ZH: We are using `tput colors` because the new version of</span></span><br><span class="line"><span class="comment"># `dircolors` added globbing in its database, making the old method</span></span><br><span class="line"><span class="comment"># broken. So we are switching to `tput colors` now.</span></span><br><span class="line"><span class="comment"># Below is the old method by checking `dircolors`.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># dircolors --print-database uses its own built-in database</span></span><br><span class="line"><span class="comment"># instead of using /etc/DIR_COLORS. Try to use the external file</span></span><br><span class="line"><span class="comment"># first to take advantage of user additions. Use internal bash</span></span><br><span class="line"><span class="comment"># globbing instead of external grep binary.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># sanitize TERM:</span></span><br><span class="line"><span class="comment">#safe_term=$&#123;TERM//[^[:alnum:]]/?&#125;</span></span><br><span class="line"><span class="comment">#match_lhs=""</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#[[-f ~/.dir_colors]] &amp;&amp; match_lhs="$&#123;match_lhs&#125;$(&lt;~/.dir_colors)"</span></span><br><span class="line"><span class="comment">#[[-f /etc/DIR_COLORS]] &amp;&amp; match_lhs="$&#123;match_lhs&#125;$(&lt;/etc/DIR_COLORS)"</span></span><br><span class="line"><span class="comment">#[[-z $&#123;match_lhs&#125;]] \</span></span><br><span class="line"><span class="comment">#	&amp;&amp; type -P dircolors &gt;/dev/null \</span></span><br><span class="line"><span class="comment">#	&amp;&amp; match_lhs=$(dircolors --print-database)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#if [[$'\n'$&#123;match_lhs&#125; == *$'\n'"TERM"$&#123;safe_term&#125;*]] ; then</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">type</span> -P tput &gt;/dev/null &amp;&amp; tput colors &gt;/dev/null 2&gt;&amp;1 &amp;&amp; [[<span class="string">"<span class="variable">$(tput colors)</span>"</span> -ge 0 ]] ; <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># we have colors :-)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># Enable colors for ls, etc. Prefer ~/.dir_colors</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">type</span> -P dircolors &gt;/dev/null ; <span class="keyword">then</span></span><br><span class="line">		<span class="keyword">if</span> [[-f ~/.dir_colors]] ; <span class="keyword">then</span></span><br><span class="line">			<span class="built_in">eval</span> $(dircolors -b ~/.dir_colors)</span><br><span class="line">		<span class="keyword">elif</span> [[-f /etc/DIR_COLORS]] ; <span class="keyword">then</span></span><br><span class="line">			<span class="built_in">eval</span> $(dircolors -b /etc/DIR_COLORS)</span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># Enable __git_ps1</span></span><br><span class="line">	<span class="keyword">if</span> [[-f /usr/share/git/git-prompt.sh]]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">source</span> /usr/share/git/git-prompt.sh</span><br><span class="line">		<span class="built_in">export</span> GIT_PS1_SHOWDIRTYSTATE=1</span><br><span class="line">		<span class="built_in">export</span> GIT_PS1_SHOWSTASHSTATE=1</span><br><span class="line">		<span class="built_in">export</span> GIT_PS1_SHOWUNTRACKEDFILES=1</span><br><span class="line">		<span class="built_in">export</span> GIT_PS1_SHOWUPSTREAM=auto</span><br><span class="line">		PS1=<span class="string">"<span class="variable">$(if [[ $&#123;EUID&#125; == 0]]; then echo'\[\033[01;31m\]\h'; else echo'\[\033[01;32m\]\u@\h'; fi)</span>\[\033[01;34m\] \w\[\033[01;33m\]\$(__git_ps1' (%s)') \[\033[01;34m\]\$([[\$? != 0]] &amp;&amp; echo'\[\033[01;31m\]:(\[\033[01;34m\] ')\\$\[\033[00m\]"</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		PS1=<span class="string">"<span class="variable">$(if [[ $&#123;EUID&#125; == 0]]; then echo'\[\033[01;31m\]\h'; else echo'\[\033[01;32m\]\u@\h'; fi)</span>\[\033[01;34m\] \w \$([[\$? != 0]] &amp;&amp; echo \"\[\033[01;31m\]:(\[\033[01;34m\] \")\\$\[\033[00m\]"</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># Use this other PS1 string if you want \W for root and \w for all other users:</span></span><br><span class="line">	<span class="comment"># PS1="$(if [[ $&#123;EUID&#125; == 0]]; then echo'\[\033[01;31m\]\h\[\033[01;34m\] \W'; else echo'\[\033[01;32m\]\u@\h\[\033[01;34m\] \w'; fi) \$([[\$? != 0]] &amp;&amp; echo \"\[\033[01;31m\]:(\[\033[01;34m\] \")\\$\[\033[00m\]"</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">alias</span> ls=<span class="string">"ls --color=auto"</span></span><br><span class="line">	<span class="built_in">alias</span> dir=<span class="string">"dir --color=auto"</span></span><br><span class="line">	<span class="built_in">alias</span> grep=<span class="string">"grep --color=auto"</span></span><br><span class="line">	<span class="built_in">alias</span> dmesg=<span class="string">'dmesg --color'</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># Uncomment the "Color" line in /etc/pacman.conf instead of uncommenting the following line...!</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># alias pacman="pacman --color=auto"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># show root@ when we do not have colors</span></span><br><span class="line"></span><br><span class="line">	PS1=<span class="string">"\u@\h \w \$([[\$? != 0]] &amp;&amp; echo \":(\")\$"</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># Use this other PS1 string if you want \W for root and \w for all other users:</span></span><br><span class="line">	<span class="comment"># PS1="\u@\h $(if [[ $&#123;EUID&#125; == 0]]; then echo'\W'; else echo'\w'; fi) \$([[\$? != 0]] &amp;&amp; echo \":(\")\$"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">PS2=<span class="string">"&gt;"</span></span><br><span class="line">PS3=<span class="string">"&gt;"</span></span><br><span class="line">PS4=<span class="string">"+"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Try to keep environment pollution down, EPA loves us.</span></span><br><span class="line"><span class="comment">#unset safe_term match_lhs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Try to enable the auto-completion (type: "pacman -S bash-completion" to install it).</span></span><br><span class="line">[-r /usr/share/bash-completion/bash_completion] &amp;&amp; . /usr/share/bash-completion/bash_completion</span><br><span class="line"></span><br><span class="line"><span class="comment"># Try to enable the "Command not found" hook ("pacman -S pkgfile" to install it).</span></span><br><span class="line"><span class="comment"># See also: https://wiki.archlinux.org/index.php/Bash#The_.22command_not_found.22_hook</span></span><br><span class="line">[-r /usr/share/doc/pkgfile/<span class="built_in">command</span>-not-found.bash ] &amp;&amp; . /usr/share/doc/pkgfile/<span class="built_in">command</span>-not-found.bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># ZH: carry alias to sudo.</span></span><br><span class="line"><span class="built_in">alias</span> sudo=<span class="string">"sudo"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ZH: make rm safer.</span></span><br><span class="line"><span class="built_in">alias</span> rm=<span class="string">"rm -i"</span></span><br></pre></td></tr></table></figure>
<h2 id="Bash-completion"><a href="#Bash-completion" class="headerlink" title="Bash completion"></a>Bash completion</h2><p>To enabling cyclic completion on tab, add the following line to your <code>.bashrc</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> <span class="string">'"\t": menu-complete'</span></span><br></pre></td></tr></table></figure>
<p>To get more completion with specific commands, install package <code>bash-completion</code>.</p>
<h2 id="Bash-command-not-found-hook"><a href="#Bash-command-not-found-hook" class="headerlink" title="Bash command not found hook"></a>Bash command not found hook</h2><p>Install package <code>pkgfile</code>.</p>
<h2 id="Execute-previous-commands-in-bash"><a href="#Execute-previous-commands-in-bash" class="headerlink" title="Execute previous commands in bash"></a>Execute previous commands in bash</h2><p><code>Ctrl+R</code> (I-search backward in emacs) can let you quickly execute command in your history.</p>
<p><code>!!</code> is substituted to be the last command in your history, but be careful when using it, for example <code>echo !!</code> will lead to unexpected behavior if <code>!!</code> is substituted to be <code>something &amp;&amp; poweroff</code>, then <code>poweroff</code> will be executed. To avoid such cases, always wrap it with quotes, like <code>echo &quot;!!&quot;</code>.</p>
<h2 id="Input-tab-or-newline-character-in-bash"><a href="#Input-tab-or-newline-character-in-bash" class="headerlink" title="Input tab or newline character in bash"></a>Input tab or newline character in bash</h2><p><code>Ctrl+V</code> in bash works as <code>Ctrl+Q</code> in emacs, which will insert the next character literally.</p>
<h2 id="Edit-current-command-in-editor"><a href="#Edit-current-command-in-editor" class="headerlink" title="Edit current command in editor"></a>Edit current command in editor</h2><p>Press <code>Ctrl+X</code> then <code>Ctrl+E</code>, and then you’ll be able to edit the current command in your editor before execution.</p>
<h2 id="Access-clipboard-in-bash"><a href="#Access-clipboard-in-bash" class="headerlink" title="Access clipboard in bash"></a>Access clipboard in bash</h2><p>Install package <code>xsel</code>. Add <code>alias xsel=&#39;xsel -b&#39;</code> to your <code>.bashrc</code>, and then you can use it like <code>xsel &lt;input_file</code> or <code>xsel &gt;output_file</code>.</p>
<h2 id="Default-font"><a href="#Default-font" class="headerlink" title="Default font"></a>Default font</h2><p>To specify your preference on default fonts, create <code>/etc/fonts/local.conf</code>, and edit it like the following example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE fontconfig SYSTEM "fonts.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fontconfig</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">match</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">test</span> <span class="attr">name</span>=<span class="string">"family"</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>sans-serif<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">"family"</span> <span class="attr">mode</span>=<span class="string">"prepend"</span> <span class="attr">binding</span>=<span class="string">"strong"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>WenQuanYi Micro Hei<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>WenQuanYi Zen Hei<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>WenQuanYi Bitmap Song<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>DejaVu Sans<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">match</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">test</span> <span class="attr">name</span>=<span class="string">"family"</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>serif<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">"family"</span> <span class="attr">mode</span>=<span class="string">"prepend"</span> <span class="attr">binding</span>=<span class="string">"strong"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>DejaVu Serif<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>WenQuanYi Bitmap Song<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>WenQuanYi Zen Hei Sharp<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>AR PL UMing CN<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>AR PL UMing TW<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>AR PL New Sung<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">match</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">test</span> <span class="attr">name</span>=<span class="string">"family"</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>monospace<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">"family"</span> <span class="attr">mode</span>=<span class="string">"prepend"</span> <span class="attr">binding</span>=<span class="string">"strong"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>WenQuanYi Micro Hei Mono<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>WenQuanYi Zen Hei Mono<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>WenQuanYi Bitmap Song<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>DejaVu Sans Mono<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fontconfig</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Now you have appropriate fonts for <code>sans-serif</code>, <code>serif</code> and <code>monospace</code> as default.</p>
<p>For more information, see <a href="https://wiki.archlinux.org/index.php/Font_configuration" target="_blank" rel="noopener">Arch Wiki</a>.</p>
<h2 id="Emoji-font"><a href="#Emoji-font" class="headerlink" title="Emoji font"></a>Emoji font</h2><p>Install <code>noto-fonts-emoji</code>.</p>
<h2 id="Install-local-font"><a href="#Install-local-font" class="headerlink" title="Install local font"></a>Install local font</h2><p>From <a href="https://wiki.archlinux.org/index.php/Fonts" target="_blank" rel="noopener">Arch Wiki</a>:</p>
<p>Drop your font files into <code>~/.local/share/fonts/</code> (<code>~/.fonts/</code> is deprecated), <code>cd</code> into that directory, and execute the following command.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -n <span class="string">"Updating font cache..."</span></span><br><span class="line"><span class="built_in">fc</span>-cache &gt;/dev/null -f</span><br><span class="line">mkfontscale</span><br><span class="line">mkfontdir</span><br><span class="line"><span class="built_in">echo</span> <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h2 id="CJK-font-not-showing-in-some-PDF-viewers"><a href="#CJK-font-not-showing-in-some-PDF-viewers" class="headerlink" title="CJK font not showing in some PDF viewers"></a>CJK font not showing in some PDF viewers</h2><p>Install <code>poppler-data</code>.</p>
<h2 id="Handle-filesystem-package-update"><a href="#Handle-filesystem-package-update" class="headerlink" title="Handle filesystem package update"></a>Handle filesystem package update</h2><p>Use <code>diff</code> and your editor to manually merge your <code>passwd</code>, <code>shadow</code>, <code>group</code> and <code>gshadow</code> with the <code>*.pacnew</code> one(s), then execute <code>pwconv</code> and <code>groupconv</code> for updating the shadow ones (<code>*-</code>).</p>
<h2 id="Sync-time-with-NTP"><a href="#Sync-time-with-NTP" class="headerlink" title="Sync time with NTP"></a>Sync time with NTP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S ntp</span><br><span class="line">sudo ntpd -gq &amp;&amp; sudo hwclock -w</span><br></pre></td></tr></table></figure>
<p>For more information, see <a href="https://wiki.archlinux.org/index.php/Time" target="_blank" rel="noopener">Arch Wiki</a>.</p>
<h2 id="Analyze-boot-time"><a href="#Analyze-boot-time" class="headerlink" title="Analyze boot time"></a>Analyze boot time</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemd-analyze blame</span><br><span class="line">systemd-analyze critical-chain</span><br></pre></td></tr></table></figure>
<p>For more information, see <code>man systemd-analyze</code>.</p>
<p>Sometimes man-db.service may slow down the booting drastically, see <a href="https://bbs.archlinux.org/viewtopic.php?pid=1409295" target="_blank" rel="noopener">this thread</a>, <a href="https://bugs.archlinux.org/task/41511" target="_blank" rel="noopener">this issue</a>, and <a href="https://bugs.archlinux.org/task/41688" target="_blank" rel="noopener">this issue</a>.</p>
<p>Sometimes journald can slow down the booting for having too many journal files, see this <a href="https://wiki.archlinux.org/index.php/systemd#Journal_size_limit" target="_blank" rel="noopener">Arch Wiki</a> to set an limit on old journal files and clean them up.</p>
<h2 id="System-backup-using-tar"><a href="#System-backup-using-tar" class="headerlink" title="System backup using tar"></a>System backup using tar</h2><p>Install AUR package <code>system-tar-and-restore</code>.</p>
<p>Example: <code>/etc/backup.conf</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Configuration file for backup.sh script.</span></span><br><span class="line"><span class="comment"># Place it in /etc/backup.conf and edit it to your needs.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the interface. Available options: cli dialog.</span></span><br><span class="line"><span class="attr">BRinterface</span>=<span class="string">"cli"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment to disable colors.</span></span><br><span class="line"><span class="comment">#BRnocolor="Yes"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment to enable verbose archiver output.</span></span><br><span class="line"><span class="comment">#BRverb="Yes"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the destination directory. Default is /.</span></span><br><span class="line"><span class="attr">BRFOLDER</span>=<span class="string">"/run/media/zh/ZH-HDD/"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment to set alternative archive name. Default is 'Backup-$(hostname)-$(date +%d-%m-%Y-%T)'.</span></span><br><span class="line"><span class="comment">#BRNAME="my_backup"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the archiver. Available options: tar bsdtar.</span></span><br><span class="line"><span class="attr">BRarchiver</span>=<span class="string">"tar"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the compressor. Available options: gzip bzip2 xz none.</span></span><br><span class="line"><span class="attr">BRcompression</span>=<span class="string">"gzip"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment to keep /home's hidden files and folders only.</span></span><br><span class="line"><span class="comment">#BRhome="No"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment to completely exclude /home directory. Use with BRhome="No".</span></span><br><span class="line"><span class="comment">#BRhidden="No"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment to set additional archiver options.</span></span><br><span class="line"><span class="attr">BR_USER_OPTS</span>=<span class="string">"--exclude=/var/cache/* --exclude=/home/zh/.cache/* --acls --xattrs"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment to disable genkernel check in gentoo.</span></span><br><span class="line"><span class="comment">#BRgenkernel="No"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment to be quiet.</span></span><br><span class="line"><span class="comment">#BRquiet="Yes"</span></span><br></pre></td></tr></table></figure>
<p>To start a backup, execute <code>backup.sh</code> as root.</p>
<h2 id="Rename-files-with-number"><a href="#Rename-files-with-number" class="headerlink" title="Rename files with number"></a>Rename files with number</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find -name <span class="string">'*.png'</span> | sort -n -r | gawk <span class="string">'&#123; printf"mv %s %03d.png\n", $0, NR &#125;'</span> | bash</span><br></pre></td></tr></table></figure>
<p>100 files, reversely:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find -name <span class="string">'*.png'</span> | sort -n -r | gawk <span class="string">'&#123; printf"mv %s %03d.png\n", $0, 100 - NR &#125;'</span> | bash</span><br></pre></td></tr></table></figure>
<p>Starting with 100:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find -name <span class="string">'*.png'</span> | sort -n -r | gawk <span class="string">'&#123; printf"mv %s %03d.png\n", $0, 100 + NR &#125;'</span> | bash</span><br></pre></td></tr></table></figure>
<h2 id="Shell-calculator"><a href="#Shell-calculator" class="headerlink" title="Shell calculator"></a>Shell calculator</h2><p>From <a href="http://askubuntu.com/questions/378661/any-command-line-calculator-for-ubuntu" target="_blank" rel="noopener">an AskUbuntu question</a>.</p>
<p>Add the following lines to your <code>.bashrc</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">=() &#123;</span><br><span class="line">input=<span class="string">"<span class="variable">$&#123;@//pi/π&#125;</span>"</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">"<span class="variable">$input</span>\nquit"</span> | gcalccmd | sed <span class="string">'s:^&gt; ::g'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>For example, <code>= &quot;e^(i*pi)+asin(1)/90&quot;</code> gives <code>0</code>.</p>
<h2 id="Use-English-named-XDG-user-directories"><a href="#Use-English-named-XDG-user-directories" class="headerlink" title="Use English-named XDG user directories"></a>Use English-named XDG user directories</h2><p>As in <a href="https://wiki.archlinux.org/index.php/Xdg_user_directories" target="_blank" rel="noopener">Arch Wiki</a>, execute <code>LC_ALL=&#39;en_US.UTF-8&#39; xdg-user-dirs-update</code>.</p>
<h2 id="GNOME-3-start-up-applications"><a href="#GNOME-3-start-up-applications" class="headerlink" title="GNOME 3 start up applications"></a>GNOME 3 start up applications</h2><p>As of GNOME 3.12, <code>gnome-session-properties</code> is removed. Instead, launch <code>gnome-tweak-tool</code> and go to the corresponding tab. If you cannot add a start up application (the add button not responding), try launching <code>gnome-tweak-tool</code> from your terminal.</p>
<p>To truly manage your start up applications, go to <code>~/.config/autostart/</code> and edit the desktop files there.</p>
<h2 id="Pomodoro-for-GNOME-3"><a href="#Pomodoro-for-GNOME-3" class="headerlink" title="Pomodoro for GNOME 3"></a>Pomodoro for GNOME 3</h2><p>Install AUR package <code>gnome-shell-pomodoro</code>.</p>
<h2 id="Clipboard-management-tool-for-GNOME-3"><a href="#Clipboard-management-tool-for-GNOME-3" class="headerlink" title="Clipboard management tool for GNOME 3"></a>Clipboard management tool for GNOME 3</h2><p>Install AUR package <code>gpaste</code>, restart GNOME shell and enable the extension GPaste.</p>
<h2 id="View-video-codec-information"><a href="#View-video-codec-information" class="headerlink" title="View video codec information"></a>View video codec information</h2><p>Use <code>ffprobe</code>.</p>
<h2 id="Clip-video"><a href="#Clip-video" class="headerlink" title="Clip video"></a>Clip video</h2><p>From <a href="http://stackoverflow.com/a/18449609/2420519" target="_blank" rel="noopener">StackOverflow</a>:</p>
<p>If you want to support video players without edit list support (or actually drop the unused frames), you need to do a re-encode, which is the default if <code>copy</code> is not specified.</p>
<p>Normally, you can use the following command to clip a video:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i &lt;INPUT_FILE&gt; [-ss &lt;START_TIME&gt;] [-to &lt;STOP_TIME&gt;] [-async 1] &lt;OUTPUT_FILE&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Convert-video-to-animated-GIF"><a href="#Convert-video-to-animated-GIF" class="headerlink" title="Convert video to animated GIF"></a>Convert video to animated GIF</h2><p>Adapted From <a href="http://dtbaker.net/random-linux-posts/convert-video-avi-mpeg-mp4-to-a-gif-animation-on-linux/" target="_blank" rel="noopener">dtbaker</a> and <a href="http://superuser.com/questions/556029/how-do-i-convert-a-video-to-gif-using-ffmpeg-with-reasonable-quality/556031" target="_blank" rel="noopener">a SuperUser question</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir frames</span><br><span class="line">ffmpeg -ss &lt;HH:MM:SS[.XXX]|START_SECONDS&gt; -t&lt;HH:MM:SS[.XXX]|DURATION_SECONDS&gt; -i &lt;YOUR_VIDEO_FILE&gt; [-r &lt;FPS&gt;] -s &lt;WIDTH_NORMALLY_480&gt;x&lt;HEIGHT_NORMALLY_270&gt; ./frames/frame%04d.png</span><br><span class="line">convert -delay &lt;100/FPS&gt; -loop 0 -layers Optimize ./frames/frame*.png output.gif</span><br></pre></td></tr></table></figure>
<p>If you need to compress your GIF file, use <code>gifsicle</code> or do it <a href="http://ezgif.com/optimize" target="_blank" rel="noopener">online</a>; for cropping, you also can use <a href="http://ezgif.com/crop" target="_blank" rel="noopener">this site</a> with option “Crop with Gifsicle” (ImageMagick output seems corrupted).</p>
<h2 id="Convert-SVG-to-PNG-or-else"><a href="#Convert-SVG-to-PNG-or-else" class="headerlink" title="Convert SVG to PNG (or else)"></a>Convert SVG to PNG (or else)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inkscape --<span class="built_in">export</span>-png=&lt;OUTPUT_FILE&gt; --<span class="built_in">export</span>-width=&lt;WIDTH&gt; --<span class="built_in">export</span>-height=&lt;HEIGHT&gt;</span><br></pre></td></tr></table></figure>
<p><code>--export-dpi</code> is also available.</p>
<p>See <code>man inkscape</code> for more formats.</p>
<h2 id="Convert-PDF-to-PNG"><a href="#Convert-PDF-to-PNG" class="headerlink" title="Convert PDF to PNG"></a>Convert PDF to PNG</h2><p>From <a href="http://stackoverflow.com/questions/6605006/convert-pdf-to-image-with-high-resolution" target="_blank" rel="noopener">StackOverflow</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convert -density 300 &lt;YOUR_FILE.pdf&gt; &lt;YOUR_FILE.png&gt;</span><br></pre></td></tr></table></figure>
<p>Where the <code>-density</code> parameter is your desired DPI.</p>
<p>Note that the <code>-density</code> parameter must come before the input file, or it won’t take effect.</p>
<h2 id="Bitmap-operation"><a href="#Bitmap-operation" class="headerlink" title="Bitmap operation"></a>Bitmap operation</h2><p>Resize:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mogrify -interpolate bicubic -resize 50% *.png</span><br></pre></td></tr></table></figure>
<p>Crop:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mogrify -crop 1080x1845+0+75 *.png</span><br></pre></td></tr></table></figure>
<h2 id="Merge-PDFs"><a href="#Merge-PDFs" class="headerlink" title="Merge PDFs"></a>Merge PDFs</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdfunite &lt;SOURCE_PDF_FILES&gt; &lt;OUTPUT_PDF_FILE&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Convert-GB-encoded-mp3-tag-to-Unicode"><a href="#Convert-GB-encoded-mp3-tag-to-Unicode" class="headerlink" title="Convert GB* encoded mp3 tag to Unicode"></a>Convert GB* encoded mp3 tag to Unicode</h2><p>Install package <code>easytag</code>.</p>
<p>Note that EasyTag may become the handler for MIME type <code>inode/directory</code>, instead of your own file manager, say, Nautilus. You can delete the default association for Easytag and inode/directory in <code>~/.local/share/applications/mimeapps.list</code>, which is managed by <code>gvfs-mime</code>. See also the MIME type section.</p>
<h2 id="Play-FLAC-with-CUE"><a href="#Play-FLAC-with-CUE" class="headerlink" title="Play FLAC with CUE"></a>Play FLAC with CUE</h2><p>Use <code>deadbeaf</code>. Rhythmbox cannot handle CUE due to its library design.</p>
<p>Install <code>deadbeef-mpris2-plugin</code> if you want MPRIS2 support (Controlling media playback in GNOME shell and other places).</p>
<p>Install <code>deadbeef-gnome-mmkeys-git</code> if you want media key support (Needs to be enabled in this plugin’s configuration after installation).</p>
<h2 id="Edit-FLAC-metadata"><a href="#Edit-FLAC-metadata" class="headerlink" title="Edit FLAC metadata"></a>Edit FLAC metadata</h2><p>Use <code>metaflac</code> from the <code>flac</code> package.</p>
<h2 id="Test-FLAC-integrity"><a href="#Test-FLAC-integrity" class="headerlink" title="Test FLAC integrity"></a>Test FLAC integrity</h2><p>Use <code>flac --test &lt;YOUR_FLAC_FILE&gt;</code>.</p>
<h2 id="Synchronize-directories"><a href="#Synchronize-directories" class="headerlink" title="Synchronize directories"></a>Synchronize directories</h2><p>Use <code>freefilesync</code>.</p>
<p>Use <code>adb-sync</code> from the <code>adb-sync-git</code> for Android.</p>
<h2 id="MIME-type-handling"><a href="#MIME-type-handling" class="headerlink" title="MIME type handling"></a>MIME type handling</h2><p>In GNOME, there are two components managing the default application for a MIME type.</p>
<p>The first one, which is system-wide, can be queried or set via <code>xdg-mime</code>.</p>
<p>The second one, which is a per-user setting, can be queried or set via <code>gvfs-mime</code>, or manually editing <code>~/.local/share/applications/mimeapps.list</code>.</p>
<p>The second one takes precedence, and I guess <code>gvfs-mime</code> is implemented partially for GNOME Open with dialog.</p>
<h2 id="Google-URL-in-Google-Chrome"><a href="#Google-URL-in-Google-Chrome" class="headerlink" title="Google URL in Google Chrome"></a>Google URL in Google Chrome</h2><p>Open <code>~/.config/google-chrome/Default/Preferences</code>, edit <code>last_known_google_url</code> and <code>last_prompted_google_url</code>.</p>
<p>If Chrome keeps reverting the url, visiting <a href="https://www.google.com/ncr" target="_blank" rel="noopener">https://www.google.com/ncr</a> may help.</p>
<h2 id="Screenshot"><a href="#Screenshot" class="headerlink" title="Screenshot"></a>Screenshot</h2><p>Shortcut keys for screenshot is listed in the search category of its setting.</p>
<ol>
<li><p>Screen to file: <code>PrtSc</code></p>
</li>
<li><p>Window to file: <code>Alt</code> + <code>PrtSc</code></p>
</li>
<li><p>Area to file: <code>Shift</code> + <code>PrtSc</code></p>
</li>
<li><p>To clipboard instead: <code>Ctrl</code> + above</p>
</li>
<li><p>Record: <code>Shift + Ctrl + Alt + R</code></p>
</li>
</ol>
<p>To open a dialog for settings before screenshot, execute <code>gnome-screenshot -i</code>.</p>
<h2 id="Resize-window-for-screenshot"><a href="#Resize-window-for-screenshot" class="headerlink" title="Resize window for screenshot"></a>Resize window for screenshot</h2><p>Enable the <code>Screenshot window sizer</code> extension in <code>gnome-tweak-tool</code>, then you can use <code>Ctrl+Atl+S</code> to cycle through a list of 16:9 window sizes.</p>
<h2 id="Save-screenshot-to-clipboard-when-PrtSc"><a href="#Save-screenshot-to-clipboard-when-PrtSc" class="headerlink" title="Save screenshot to clipboard when PrtSc"></a>Save screenshot to clipboard when PrtSc</h2><p>Swap the values of <code>org.gnome.settings-daemon.plugins.media-keys.{,area-,window-}screenshot{,-clip}</code>.</p>
<h2 id="Remapping-ThinkPad-keys"><a href="#Remapping-ThinkPad-keys" class="headerlink" title="Remapping ThinkPad keys"></a>Remapping ThinkPad keys</h2><p>On my ThinkPad T450, the usual location for Menu key is a PrtSc key, and <code>Fn</code> + <code>F9</code>–<code>F12</code> doesn’t map to media keys. <code>xmodmap</code> didn’t work, and modification to <code>xkb</code> database gets overwritten when <code>xkeyboard-config</code> updates. So here is the way to achieve this this with udev hwdb.</p>
<p>Create file <code>/etc/udev/hwdb.d/90-zh-thinkpad.hwdb</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">evdev:atkbd:dmi:bvn*:bvr*:bd*:svnLENOVO*:pn*:pvrThinkPad*</span><br><span class="line"> KEYBOARD_KEY_b7=compose</span><br><span class="line"> KEYBOARD_KEY_d2=sysrq</span><br><span class="line"></span><br><span class="line">evdev:name:ThinkPad Extra Buttons:dmi:bvn*:bvr*:bd*:svnLENOVO*:pn*:pvrThinkPad*</span><br><span class="line"> KEYBOARD_KEY_1c=playpause</span><br><span class="line"> KEYBOARD_KEY_1d=stopcd</span><br><span class="line"> KEYBOARD_KEY_1e=previoussong</span><br><span class="line"> KEYBOARD_KEY_1f=nextsong</span><br></pre></td></tr></table></figure>
<p>And run <code>sudo systemd-hwdb update &amp;&amp; sudo udevadm trigger</code>. Enjoy the remapped keys!</p>
<h2 id="Control-ThinkPad-battery-charging"><a href="#Control-ThinkPad-battery-charging" class="headerlink" title="Control ThinkPad battery charging"></a>Control ThinkPad battery charging</h2><p><a href="https://wiki.archlinux.org/index.php/Tp_smapi" target="_blank" rel="noopener">tp_smapi</a> has been out of date for a long time, and it did not support my T450. Newer models of ThinkPad should use <a href="https://aur.archlinux.org/packages/tpacpi-bat/" target="_blank" rel="noopener">tpacpi-bat</a> instead.</p>
<p>For simplicity, there is a <a href="https://wiki.archlinux.org/index.php/Tp-battery-mode" target="_blank" rel="noopener">tp-battery-mode</a> package. Install it, enable and start the service, and you are done.</p>
<h2 id="Recover-lost-free-space-on-Ext2-3-4-partitions"><a href="#Recover-lost-free-space-on-Ext2-3-4-partitions" class="headerlink" title="Recover lost free space on Ext2/3/4 partitions"></a>Recover lost free space on Ext2/3/4 partitions</h2><p>Ext2/3/4 filesystem keeps 5% of its blocks reserved and usable only by root, which ensures that a normal user cannot fill the whole disk and cause the system to fail.</p>
<p>However on data partitions such as <code>/home</code>, this might be a waste of space. To get around this limitation, run <code>sudo tune2fs -m 0 /dev/sdXX</code>, which can be done online.</p>
<h2 id="Draw-graphs"><a href="#Draw-graphs" class="headerlink" title="Draw graphs"></a>Draw graphs</h2><p>LibreOffice Draw, and use its connectors instead of bare wires. Shift for regular shape and Ctrl + Mouse move for cloning can also be handy.</p>
<h2 id="Render-GFM"><a href="#Render-GFM" class="headerlink" title="Render GFM"></a>Render GFM</h2><p>Bash script from <a href="https://gist.github.com/jaburns/33d88f4aa99bb4ab6ad6" target="_blank" rel="noopener">jaburn’s gist</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">data=<span class="string">"<span class="variable">$(</span></span></span><br><span class="line"><span class="string"><span class="variable">    cat"$1"\</span></span></span><br><span class="line"><span class="string"><span class="variable">      | sed's/"/\\"/g'\</span></span></span><br><span class="line"><span class="string"><span class="variable">      | sed':a;N;$!ba;s/\n/\\n/g'\</span></span></span><br><span class="line"><span class="string"><span class="variable">)</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[-z <span class="string">"<span class="variable">$2</span>"</span> ]]; <span class="keyword">then</span></span><br><span class="line">    context=<span class="string">''</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    context=<span class="string">",\"context\":\"<span class="variable">$2</span>\""</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;!DOCTYPE html&gt;'</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;html&gt;&lt;head&gt;&lt;style&gt;'</span></span><br><span class="line">curl -s <span class="string">'https://gist.githubusercontent.com/andyferra/2554919/raw/2e66cabdafe1c9a7f354aa2ebf5bc38265e638e5/github.css'</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;/style&gt;&lt;/head&gt;&lt;body&gt;'</span></span><br><span class="line">curl -s --data <span class="string">"&#123;\"text\":\"<span class="variable">$data</span>\",\"mode\":\"gfm\"<span class="variable">$context</span>&#125;"</span> <span class="string">'https://api.github.com/markdown'</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;/body&gt;&lt;/html&gt;'</span></span><br></pre></td></tr></table></figure>
<h2 id="Generate-mosaic-image"><a href="#Generate-mosaic-image" class="headerlink" title="Generate mosaic image"></a>Generate mosaic image</h2><p>See <a href="http://askubuntu.com/questions/249568/software-for-making-mosaic-image-from-a-collection-of-images" target="_blank" rel="noopener">this question</a>.</p>
<h2 id="Minecraft-with-Forge-crashes-on-splash-screen"><a href="#Minecraft-with-Forge-crashes-on-splash-screen" class="headerlink" title="Minecraft with Forge crashes on splash screen"></a>Minecraft with Forge crashes on splash screen</h2><p>Sometimes Minecraft with Forge can crash with a message like the following one:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[xcb] Unknown request in queue while dequeuing</span><br></pre></td></tr></table></figure>
<p>Disabling the Forge splash screen by setting <code>enabled=false</code> in <code>.minecraft/config/splash.properties</code> can workaround this problem.</p>
<h2 id="Cannot-start-graphical-application-under-su-or-sudo-on-XWayland"><a href="#Cannot-start-graphical-application-under-su-or-sudo-on-XWayland" class="headerlink" title="Cannot start graphical application under su or sudo on XWayland"></a>Cannot start graphical application under su or sudo on XWayland</h2><p>Execute <code>xhost +local:</code> to allow local connections to X server.</p>
<h2 id="Better-Rhythmbox-UI-design"><a href="#Better-Rhythmbox-UI-design" class="headerlink" title="Better Rhythmbox UI design"></a>Better Rhythmbox UI design</h2><p>Install and enable <a href="https://aur.archlinux.org/packages/rhythmbox-plugin-alternative-toolbar-git/" target="_blank" rel="noopener">Alternative Toolbar</a>.</p>
<h2 id="Install-Xilinx-ISE"><a href="#Install-Xilinx-ISE" class="headerlink" title="Install Xilinx ISE"></a>Install Xilinx ISE</h2><p>Modified from <a href="https://wiki.archlinux.org/index.php/Xilinx_ISE_WebPACK" target="_blank" rel="noopener">Arch Wiki</a>:</p>
<ol>
<li>Download Xilinx ISE Installer from <a href="http://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/design-tools.html" target="_blank" rel="noopener">here</a>.</li>
<li>Install <code>ncurses5-compat-libs</code>, it is a required dependency of the installer.</li>
<li>Untar only the first image, execute <code>sudo xsetup</code>, choose system edition, uncheck sending data, and leave other options the default. You don’t need to check the “Install cable driver” option. Don’t try to build a custom package for it; it’s painful and buggy.</li>
<li>Fix <code>libstdc++.so</code> as in <a href="https://wiki.archlinux.org/index.php/Xilinx_ISE_WebPACK#Dynamic_Library_Fix_.28libstdc.2B.2B.so.29" target="_blank" rel="noopener">here</a>.</li>
<li>Install Digilent USB-JTAG drivers as in <a href="https://wiki.archlinux.org/index.php/Xilinx_ISE_WebPACK#Digilent_USB-JTAG_Drivers" target="_blank" rel="noopener">here</a>. You don’t need to install <code>fxload</code>, or add yourself to the <code>uucp</code> group, or add a udev rule. You can program the device with the command <code>djtgcfg</code> with <code>digilent.adept.utilities</code> installed.</li>
<li>Create <code>~/.local/share/applications/xilinx-ise.desktop</code> as in <a href="https://wiki.archlinux.org/index.php/Xilinx_ISE_WebPACK#Launching_via_desktop_icons" target="_blank" rel="noopener">here</a>. My alternative version is given below.</li>
<li>Get a license, and feed it to the license manager.</li>
</ol>
<p><code>xilinx-ise.desktop</code>:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Desktop Entry]</span></span><br><span class="line"><span class="attr">Categories</span>=Development;</span><br><span class="line"><span class="attr">Comment</span>=Xilinx ISE</span><br><span class="line"><span class="attr">Encoding</span>=UTF-<span class="number">8</span></span><br><span class="line"><span class="attr">Exec</span>=sh -c <span class="string">"unset LANG &amp;&amp; unset QT_PLUGIN_PATH &amp;&amp; source /opt/Xilinx/14.7/ISE_DS/settings64.sh &amp;&amp; export PRINTER=null &amp;&amp; ise"</span></span><br><span class="line"><span class="attr">GenericName</span>=Xilinx ISE</span><br><span class="line"><span class="attr">Icon</span>=/opt/Xilinx/<span class="number">14.7</span>/ISE_DS/ISE/data/images/pn-ise.png</span><br><span class="line"><span class="attr">Keywords</span>=Xlinx;ISE</span><br><span class="line"><span class="attr">Name</span>=Xilinx ISE</span><br><span class="line"><span class="attr">StartupNotify</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">Type</span>=Application</span><br></pre></td></tr></table></figure>
<p>By adding <code>export PRINTER=null</code> you can print schematic file to PDF once per launch. This is a bug in Xilinx ISE.</p>
<h2 id="Additional-tools"><a href="#Additional-tools" class="headerlink" title="Additional tools"></a>Additional tools</h2><ul>
<li><code>ack</code>: <code>grep</code> replacement.</li>
<li><code>cloc</code>: Count lines of code.</li>
<li><code>dos2unix</code>: Convert End-of-line and some encoding to Unix flavor.</li>
<li><code>dosfstools</code>: <code>mkfs.fat</code>, etc.</li>
<li><code>easytag</code>: MP3 tag editing and conversion.</li>
<li><code>gpaste</code>: Clipboard manager</li>
<li><code>gsmartcontrol</code>: Graphical SMART viewer.</li>
<li><code>haveged</code>: Boost low entropy.</li>
<li><code>htop</code>: <code>top</code> replacement.</li>
<li><code>iotop</code>: <code>top</code> on I/O.</li>
<li><code>jq</code>: Manipulate JSON in command line.</li>
<li><code>lsof</code>: List opened files.</li>
<li><code>mtr</code>: <code>traceroute</code> + <code>ping</code>, automatically.</li>
<li><code>nload</code>: Display current network usage.</li>
<li><code>ntfs-3g</code>: NTFS writing support, and others.</li>
<li><code>pastebinit</code>: Various pastebin services.</li>
<li><code>pdfgrep</code>: <code>grep</code> on PDF.</li>
<li><code>powertop</code>: Show power consumption.</li>
<li><code>profile-cleaner</code>: Optimize browser profile SQLite database, and more.</li>
<li><code>proxychains</code>: Proxify other programs.</li>
<li><code>pv</code>: View progress for <code>dd</code>, etc.</li>
<li><code>rlwrap</code>: Wrap programs with readline style input.</li>
<li><code>tig</code>: Git repository browser.</li>
<li><code>translate-shell</code>: Command-line translator using Google Translate or others.</li>
<li><code>trash-cli</code>: Trash bin in command line.</li>
<li><code>tree</code>: <code>ls</code> recursively in tree format.</li>
<li><code>vipe</code>: Run editor in middle of a pipeline.</li>
<li><code>vlc</code>: Versatile and stable video player.</li>
</ul>

    
  </div>
  <footer class="entry-footer">
    <div class="entry-meta-footer">
      <span class="category">
        

      </span>
      <span class="tags">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/note/">Note</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/software/">Software</a></li></ul>


      </span>
    </div>
  </footer>
  
    
<nav id="article-nav">
  
    <a href="/qsc-mobile-android-v3/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">
        
          求是潮手机站 Android 客户端 V3
        
      </div>
    </a>
  
  
    <a href="/android-design-guide/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          Android 设计简明教程
        
      </div>
    </a>
  
</nav>


  
</article>




  <section id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>



    </section>
    <div class="mb-search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:blog.zhanghai.me">
    </form>
</div>
<footer id="footer">
  <h1 class="footer-blog-title">
    <a href="/">梦断代码</a>
  </h1>
  <span class="copyright">
    &copy; 2019 张海<br>
    Modify from <a href="http://sanographix.github.io/tumblr/apollo/" target="_blank">Apollo</a> theme, designed by <a href="http://www.sanographix.net/" target="_blank">SANOGRAPHIX.NET</a><br>
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
  </span>
</footer>

    
<script>
  var disqus_shortname = 'zhanghai';
  
  var disqus_url = 'http://blog.zhanghai.me/arch-linux-notes/';
  
  (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//cdn.staticfile.org/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
